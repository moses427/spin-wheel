<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Jeswanth Billing</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body { background:#f2f4f7; }
    .invoice-box {
      background:#fff;
      padding:20px;
      border-radius:10px;
      box-shadow:0 0 10px rgba(0,0,0,.1);
    }
    .logo {
      max-height: 80px;
      margin-bottom: 10px;
    }
    .small-text {
      font-size: 13px;
      color: #555;
    }
    @media print {
      button, input, select { display:none !important; }
      body { background:#fff; }
    }
  </style>
</head>

<body>
<div class="container my-4">
  <div class="invoice-box">

    <!-- LOGO -->
    <div class="text-center">
      <img src="logo.jpg" class="logo" alt="Shop Logo">
    </div>

    <!-- SHOP NAME & ADDRESS -->
    <h4 class="text-center">JESWANTH MENS & FASHION HUB</h4>
    <p class="text-center small-text">
      Premium menswear & kidswear collections<br>
      Quality clothing at affordable prices<br>
      Trusted local store since day one<br><br>
      üìç Rameswaram Street, T Nagar,<br>
      Chennai ‚Äì 600017
    </p>

    <hr>

    <!-- BILL INFO -->
    <div class="row mb-3">
      <div class="col">
        <strong>Invoice No:</strong> <span id="invoiceNo"></span>
      </div>
      <div class="col text-end">
        <strong>Date:</strong> <span id="date"></span>
      </div>
    </div>

    <!-- CUSTOMER -->
    <div class="row mb-3">
      <div class="col-md-4">
        <input class="form-control" placeholder="Customer Name" id="customerName">
      </div>
      <div class="col-md-4">
        <input class="form-control" placeholder="Mobile Number" id="customerMobile">
      </div>
      <div class="col-md-4">
        <select class="form-control" id="paymentMode">
          <option>Payment Mode</option>
          <option>Cash</option>
          <option>Card</option>
          <option>UPI</option>
        </select>
      </div>
    </div>

    <!-- ITEMS -->
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>Item</th>
          <th>Qty</th>
          <th>Price</th>
          <th>Total</th>
        </tr>
      </thead>
      <tbody id="itemBody"></tbody>
    </table>

    <button class="btn btn-secondary mb-3" onclick="addRow()">+ Add Item</button>

    <!-- TOTAL -->
    <div class="row">
      <div class="col-md-6">
        <input type="number" id="discount" class="form-control"
               placeholder="Discount (‚Çπ)" oninput="calc()">
      </div>
      <div class="col-md-6 text-end">
        <p><strong>Sub Total:</strong> ‚Çπ <span id="subTotal">0</span></p>
        <p><strong>Discount:</strong> ‚Çπ <span id="discShow">0</span></p>
        <h5><strong>Final Amount:</strong> ‚Çπ <span id="finalTotal">0</span></h5>
      </div>
    </div>

    <hr>

    <!-- THANK YOU -->
    <p class="text-center small-text">
      Thank you for shopping with us üôè<br>
      Visit again & support local business ‚ù§Ô∏è
    </p>

    <!-- PRINT -->
    <div class="text-center">
      <button class="btn btn-success" onclick="printAndSave()">Print / Save PDF</button>
    </div>

    <hr>

    <!-- BILL HISTORY -->
    <h5 class="text-center">üìú Bill History</h5>
    <table class="table table-sm table-bordered">
      <thead>
        <tr>
          <th>Invoice</th>
          <th>Date</th>
          <th>Customer</th>
          <th>Mobile</th>
          <th>Payment</th>
          <th>Total</th>
        </tr>
      </thead>
      <tbody id="historyBody"></tbody>
    </table>

  </div>
</div>

<!-- Firebase + JS -->
<script type="module">
  // Firebase imports
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

  // Firebase config (replace with your own)
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
    databaseURL: "https://YOUR_PROJECT_ID-default-rtdb.firebaseio.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT_ID.appspot.com",
    messagingSenderId: "SENDER_ID",
    appId: "APP_ID"
  };

  const app = initializeApp(firebaseConfig);
  const database = getDatabase(app);

  // Date & Invoice
  document.getElementById("date").innerText = new Date().toLocaleDateString();
  let inv = localStorage.getItem("invNo") || 1001;
  document.getElementById("invoiceNo").innerText = inv;
  localStorage.setItem("invNo", ++inv);

  // Add item row
  function addRow() {
    let row = `
      <tr>
        <td><input class="form-control"></td>
        <td><input type="number" class="form-control qty" value="1" oninput="calc()"></td>
        <td><input type="number" class="form-control price" value="0" oninput="calc()"></td>
        <td class="total">0</td>
      </tr>`;
    document.getElementById("itemBody").innerHTML += row;
  }

  // Calculate totals
  function calc() {
    let qty = document.querySelectorAll(".qty");
    let price = document.querySelectorAll(".price");
    let total = document.querySelectorAll(".total");
    let sub = 0;
    qty.forEach((q,i)=>{
      let t = q.value * price[i].value;
      total[i].innerText = t;
      sub += t;
    });
    let disc = Number(document.getElementById("discount").value || 0);
    let final = sub - disc;
    document.getElementById("subTotal").innerText = sub;
    document.getElementById("discShow").innerText = disc;
    document.getElementById("finalTotal").innerText = final < 0 ? 0 : final;
  }

  addRow();

  // Save bill to Firebase
  function saveBillOnline(billData) {
    set(ref(database, 'bills/' + billData.invoice), billData);
  }

  // Print & Save
  function printAndSave() {
    const customer = document.getElementById("customerName").value;
    const mobile = document.getElementById("customerMobile").value;
    const payment = document.getElementById("paymentMode").value;
    const total = document.getElementById("finalTotal").innerText;
    const date = document.getElementById("date").innerText;
    const invoice = document.getElementById("invoiceNo").innerText;

    const billData = { invoice, date, customer, mobile, payment, total };
    saveBillOnline(billData);

    window.print();
  }

  // Load Bill History
  const historyRef = ref(database, "bills");
  onValue(historyRef, (snapshot) => {
    const data = snapshot.val();
    const tbody = document.getElementById("historyBody");
    tbody.innerHTML = "";
    if (data) {
      Object.values(data).reverse().forEach(bill => {
        let row = `
          <tr>
            <td>${bill.invoice}</td>
            <td>${bill.date}</td>
            <td>${bill.customer}</td>
            <td>${bill.mobile}</td>
            <td>${bill.payment}</td>
            <td>‚Çπ${bill.total}</td>
          </tr>
        `;
        tbody.innerHTML += row;
      });
    }
  });
</script>
</body>
</html>
